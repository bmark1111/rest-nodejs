var mysql	= require("mysql");
//var connection = false;

var db = {
	connection: false,
	connect: function(callback) {
		var pool = mysql.createPool({
			connectionLimit	: 100,
			host			: 'localhost',
			user			: 'root',
			password		: '',
			database		: 'restful_api_demo',
			debug			: false
		});
		pool.getConnection(function(err, db_connection) {
			if(err) {
				db.connection = false;
			} else {
				db.connection = db_connection;
				callback();
			}
		});
	},
	get: function (id, callback) {
console.log('db get')
		var query = "SELECT * FROM ??";
		if (id)
		{
			query += " WHERE ??=?";
			var table = ["user_login", "user_id", id];
		} else {
			var table = ["user_login"];
		}
		query = mysql.format(query, table);
		db.connection.query(query, function(err, rows) {
			if(err) {
//				self.res.json({"Error" : true, "Message" : "Error executing MySQL query - /users/list/GET"});
				return false;
			} else {
				callback(rows);
			}
		});
	}, 
	create: function(body, callback) {
		var query = "INSERT INTO ??(??,??) VALUES (?,?)";
		var table = ["user_login", "user_email", "user_password", body.email, body.password];
		query = mysql.format(query, table);
		db.connection.query(query, function(err, rows) {
			if(err) {
//				self.res.json({"Error" : true, "Message" : "Error executing MySQL query - possible duplicate user - /users/POST"});
			} else {
				callback(rows);
			}
		});
	}, 
	update: function(body, callback) {
		var query = "UPDATE ?? SET ?? = ? WHERE ?? = ?";
		var table = ["user_login", "user_password", body.password, "user_email", body.email];
		query = mysql.format(query, table);
		db.connection.query(query, function(err, rows) {
			if(err) {
//				self.res.json({"Error" : true, "Message" : "Error executing MySQL query - /users/PUT"});
			} else {
				callback(rows);
			}
		});
	}, 
	run: function(callback) {
		callback(null, this.returnData || {})
	}
};

module.exports = db;
