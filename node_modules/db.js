var mysql	= require("mysql");
var db_connection = false;

var db = {
	'connect': function(callback) {
		var pool = mysql.createPool({
			connectionLimit	: 100,
			host			: 'localhost',
			user			: 'root',
			password		: '',
			database		: 'restful_api_demo',
			debug			: false
		});
		pool.getConnection(function(err, connection) {
			if(err) {
				db_connection = false;
			} else {
				db_connection = connection;
				callback();
			}
		});
	},
	'get': function (id, callback, errCallback) {
		var query = "SELECT * FROM ??";
		if (id)
		{
			query += " WHERE ??=?";
			var table = ["user_login", "user_id", id];
		} else {
			var table = ["user_login"];
		}
		query = mysql.format(query, table);
		db_connection.query(query, function(err, rows) {
			if(err) {
				errCallback(err);
			} else {
				callback(rows);
			}
		});
	}, 
	'create': function(body, callback, errCallback) {
		var query = "INSERT INTO ??(??,??) VALUES (?,?)";
		var table = ["user_login", "user_email", "user_password", body.email, body.password];
		query = mysql.format(query, table);
		db_connection.query(query, function(err, rows) {
			if(err) {
				errCallback(err);
			} else {
				callback(rows);
			}
		});
	}, 
	'update': function(body, callback, errCallback) {
		var query = "UPDATE ?? SET ?? = ? WHERE ?? = ?";
		var table = ["user_login", "user_password", body.password, "user_email", body.email];
		query = mysql.format(query, table);
		db_connection.query(query, function(err, rows) {
			if(err) {
				errCallback(err);
			} else {
				callback(rows);
			}
		});
	}, 
	'remove': function(id, callback, errCallback) {
		var query = "DELETE from ?? WHERE ??=?";
		var table = ["user_login", "user_email", id];
		query = mysql.format(query, table);
		db_connection.query(query, function(err, rows) {
			if(err) {
				errCallback(err);
			} else {
				callback(rows);
			}
		});
	}, 
	'run': function(callback, errCallback) {
		callback(null, this.returnData || {})
	}
};

module.exports = db;
